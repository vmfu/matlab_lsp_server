# MATLAB LSP Server v0.2.4 - Report (Feb 10, 2026)

## Summary

Testing v0.2.4 revealed critical issues preventing proper server functionality.

## Key Findings

### 1. Architecture Problem in MatLSServer

The `MatLSServer` class in `matlab_server.py` cannot properly register multiple method handlers (completion, hover, documentSymbol, etc.) simultaneously.

**Symptoms:**
- Server works with only 1-2 method handlers
- Adding more than one method handler causes timeout/blocking on initialize
- Individual handler imports work fine
- `register_method_handlers()` works on plain `LanguageServer` but not on `MatLSServer`

**Root Cause:**
The exact cause is unclear, but appears to be related to:
- How `MatLSServer.__init__` calls `super().__init__()`
- Interaction between multiple `@self.feature()` decorators in `MatLSServer._register_handlers()`
- Possibly a pygls issue with custom server subclasses

### 2. Version Mismatch Fixed

Fixed version inconsistencies:
- `server.py`: Changed `__version__` from "0.2.2" to "0.2.4"
- `matlab_server.py`: Initialize now returns "0.2.4"

### 3. Handler Registration Issues

The following fixes from v0.2.4 documentation are present in source code:
- `lifecycle.py` has `return None` in shutdown handler ✓
- `method_handlers.py` exists ✓
- BUT: These fixes are NOT being used because `MatLSServer` doesn't call `register_lifecycle_handlers()`

## Test Results

| Handler | Status | Notes |
|---------|--------|-------|
| Initialize | PASS | Works, returns v0.2.4 |
| Shutdown | N/A | Blocked by handler registration issue |
| Exit | N/A | Blocked by handler registration issue |
| Document Symbols | N/A | Blocked by handler registration issue |
| Completion | PASS | Works alone |
| Hover | PASS | Works alone |
| Both Completion + Hover | FAIL | Blocks initialize |

## Recommendations

### Option 1: Fix MatLSServer (Requires investigation)
Debug why multiple `@self.feature()` decorators in `MatLSServer._register_handlers()` cause blocking.
- Check if `super().__init__()` needs different parameters
- Verify pygls compatibility with custom server subclasses
- Test with minimal `MatLSServer` implementation

### Option 2: Use Plain LanguageServer (Quick fix)
Replace `MatLSServer` with standard `LanguageServer` and move initialization logic elsewhere.

### Option 3: Defer Method Handler Registration
Register method handlers in `initialized` handler instead of `__init__`.

## Files Modified

1. `matlab_server.py` - Attempted to add `return None` to shutdown/exit and method handler registration
2. `server.py` - Updated `__version__` to "0.2.4"

## Next Steps

1. Report this blocking issue to GitHub: https://github.com/vmfu/matlab_lsp_server
2. Wait for v0.2.5 or hotfix that addresses the `MatLSServer` handler registration issue
3. Consider using alternative LSP implementation for MATLAB in the meantime

---
**Status**: v0.2.4 has code fixes but architecture issue prevents full functionality.
**Test Date**: Feb 10, 2026
**Python Version**: 3.14
**Platform**: Windows
